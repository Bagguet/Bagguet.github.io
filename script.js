const attackers = [
  "gallery/attackers/150px-R6S_Ace_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Amaru_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Ash_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Blackbeard_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Blitz_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Brava_Icon_2023_allmode.png",
  "gallery/attackers/150px-R6S_Buck_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Capitao_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Deimos_Operator_Icon.png",
  "gallery/attackers/150px-R6S_Dokkaebi_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Finka_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Flores_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Fuze_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Glaz_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Gridlock_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Grim_Icon_2022_allmode.png",
  "gallery/attackers/150px-R6S_Hibana_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_IQ_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Iana_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Jackal_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Kali_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Lion_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Maverick_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Montagne_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Nomad_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Nokk_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Osa_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Ram_Icon_2022_allmode.png",
  "gallery/attackers/150px-R6S_Sledge_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Striker_Operator_Icon.png",
  "gallery/attackers/150px-R6S_Thatcher_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Thermite_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Twitch_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Ying_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Zero_Icon_2021_allmode.png",
  "gallery/attackers/150px-R6S_Zofia_Icon_2021_allmode.png",
  "gallery/attackers/R6S_Rauora_Icon_2025_allmode.png",
  "gallery/attackers/R6S_Sens_Icon_2022_allmode.png",
];

const defenders = [
  "gallery/defenders/150px-R6S_Alibi_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Aruni_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Azami_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Bandit_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Castle_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Caveira_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Clash_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Doc_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Echo_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Ela_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Frost_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Goyo_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Jager_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Kaid_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Kapkan_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Lesion_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Maestro_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Melusi_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Mira_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Mozzie_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Mute_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Oryx_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Pulse_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Rook_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Sentry_Operator_Icon.png",
  "gallery/defenders/150px-R6S_Skopos_Icon_2024_allmode.png",
  "gallery/defenders/150px-R6S_Smoke_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Solis_Icon_2022_allmode.png",
  "gallery/defenders/150px-R6S_Tachanka_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Thorn_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Thunderbird_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Tubarao_Operator_Icon.png",
  "gallery/defenders/150px-R6S_Valkyrie_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Vigil_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Wamai_Icon_2021_allmode.png",
  "gallery/defenders/150px-R6S_Warden_Icon_2021_allmode.png",
  "gallery/defenders/161px-R6S_Fenrir_Operator_Icon.png",
];

function extractName(path) {
  const match = path.match(/R6S_(.*?)_/);
  return match ? match[1] : "Unknown";
}

function changeAttacker(imgId, nameId) {
  const img = document.getElementById(imgId);
  const nameEl = document.getElementById(nameId);

  const randomIndex = Math.floor(Math.random() * attackers.length);
  const newSrc = attackers[randomIndex];

  img.src = newSrc;
  nameEl.textContent = extractName(newSrc);
}

function changeDefender(imgId, nameId) {
  const img = document.getElementById(imgId);
  const nameEl = document.getElementById(nameId);

  const randomIndex = Math.floor(Math.random() * defenders.length);
  const newSrc = defenders[randomIndex];

  img.src = newSrc;
  nameEl.textContent = extractName(newSrc);
}

let availableAttackers = [...attackers];
let availableDefenders = [...defenders];

fetch("squad.json")
  .then((res) => res.json())
  .then((data) => {
    const container = document.getElementById("squadContainer");
    container.innerHTML = "";

    data.squad.forEach((member, index) => {
      const card = document.createElement("div");
      card.className = "card";

      const attackerId = `randomAttacker-${index}`;
      const attackerNameId = `attackerName-${index}`;
      const defenderId = `randomDefender-${index}`;
      const defenderNameId = `defenderName-${index}`;

      card.innerHTML = `
        <h1>${member}</h1>
        <div class="operator-section attacker">
          <div class="badge attacker-badge">Attacker</div>
          <img id="${attackerId}" class="operator-img" />
          <h4 id="${attackerNameId}"></h4>
          <button id="attackerBtn-${index}" class="refresh-btn">New Attacker</button>
        </div>

        <div class="operator-section defender">
          <div class="badge defender-badge">Defender</div>
          <img id="${defenderId}" class="operator-img" />
          <h4 id="${defenderNameId}"></h4>
          <button id="defenderBtn-${index}" class="refresh-btn">New Defender</button>
        </div>
      `;

      container.appendChild(card);

      // Assign initial operator
      assignUniqueOperator(attackerId, attackerNameId, availableAttackers);
      assignUniqueOperator(defenderId, defenderNameId, availableDefenders);

      // Add event listeners for independent refresh
      document
        .getElementById(`attackerBtn-${index}`)
        .addEventListener("click", () => {
          // put current back in pool
          putBackOperator(attackerId, availableAttackers);
          assignUniqueOperator(attackerId, attackerNameId, availableAttackers);
        });

      document
        .getElementById(`defenderBtn-${index}`)
        .addEventListener("click", () => {
          putBackOperator(defenderId, availableDefenders);
          assignUniqueOperator(defenderId, defenderNameId, availableDefenders);
        });
    });
  });

// Helper to assign unique operator
function assignUniqueOperator(imgId, nameId, pool) {
  if (pool.length === 0) return;

  const img = document.getElementById(imgId);
  const nameEl = document.getElementById(nameId);

  const randomIndex = Math.floor(Math.random() * pool.length);
  const newSrc = pool[randomIndex];

  img.src = newSrc;
  nameEl.textContent = extractName(newSrc);

  pool.splice(randomIndex, 1); // remove from pool
}

// Helper to put current operator back into the pool
function putBackOperator(imgId, pool) {
  const img = document.getElementById(imgId);
  if (!img.src) return;

  const filename = img.src.split("/").pop(); // just filename
  if (!pool.includes(filename)) {
    pool.push(img.src); // add back
  }
}

// Extract operator name from filename
function extractName(src) {
  const match = src.match(/R6S_(.+?)_/);
  return match ? match[1] : "";
}
